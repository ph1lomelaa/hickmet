# üåê API: –¢–ï–°–¢–û–í–´–ô –†–ï–ñ–ò–ú vs PRODUCTION

## ‚ùì –ü–†–û–ë–õ–ï–ú–ê

WebApp (`index.html`, `history_v2.html`) –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `window.BULL_API_URL` –¥–ª—è –æ–±—Ä–∞—â–µ–Ω–∏—è –∫ API.

–ï—Å–ª–∏ API –∏–¥–µ—Ç –Ω–∞ **Koyeb (production)**, —Ç–æ —Ç–∞–º –Ω–µ—Ç –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö `USE_TEST_TABLE`, –∏ –ø–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è **production —Ç–∞–±–ª–∏—Ü—ã**.

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï 1: –õ–û–ö–ê–õ–¨–ù–´–ô API (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø –î–õ–Ø –¢–ï–°–¢–ò–†–û–í–ê–ù–ò–Ø)

### –®–∞–≥ 1: –ó–∞–ø—É—Å—Ç–∏ –ª–æ–∫–∞–ª—å–Ω—ã–π API —Å–µ—Ä–≤–µ—Ä

```bash
cd /Users/muslimakosmagambetova/Downloads/tired2\ 2/bull_project
./run_api_test.sh
```

**–ß—Ç–æ –ø—Ä–æ–∏–∑–æ–π–¥–µ—Ç:**
- API –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è –Ω–∞ `http://localhost:8000`
- –ë—É–¥–µ—Ç –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **—Ç–µ—Å—Ç–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É** (`USE_TEST_TABLE=true`)
- Production –¥–∞–Ω–Ω—ã–µ –∑–∞—â–∏—â–µ–Ω—ã ‚úÖ

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π WebApp –Ω–∞ –ª–æ–∫–∞–ª—å–Ω—ã–π API

**–í—Ä–µ–º–µ–Ω–Ω–æ–µ —Ä–µ—à–µ–Ω–∏–µ** (–¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è –≤ –±—Ä–∞—É–∑–µ—Ä–µ):

–û—Ç–∫—Ä–æ–π `index.html` –∏ `history_v2.html` –ª–æ–∫–∞–ª—å–Ω–æ –∏ –¥–æ–±–∞–≤—å –ø–µ—Ä–µ–¥ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º:

```html
<script>
    // –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –ª–æ–∫–∞–ª—å–Ω—ã–π API –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
    window.BULL_API_URL = "http://localhost:8000";
</script>
```

**–ò–õ–ò** –∏—Å–ø–æ–ª—å–∑—É–π browser console:
```javascript
window.BULL_API_URL = "http://localhost:8000"
```

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å

1. –û—Ç–∫—Ä–æ–π WebApp (—á–µ—Ä–µ–∑ –±–æ—Ç–∞ –∏–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ)
2. API –∑–∞–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –∏–¥—Ç–∏ –Ω–∞ `http://localhost:8000`
3. –ü—Ä–∏ –≤—ã–±–æ—Ä–µ —Ç–∞–±–ª–∏—Ü—ã ‚Äî **—Ç–æ–ª—å–∫–æ TEST —Ç–∞–±–ª–∏—Ü–∞**

---

## ‚úÖ –†–ï–®–ï–ù–ò–ï 2: –î–û–ë–ê–í–ò–¢–¨ –ü–ï–†–ï–ú–ï–ù–ù–´–ï –í KOYEB (–¥–ª—è production —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è)

–ï—Å–ª–∏ —Ö–æ—á–µ—à—å —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å —Å **—Ä–µ–∞–ª—å–Ω—ã–º API –Ω–∞ Koyeb**, –Ω–æ —Å —Ç–µ—Å—Ç–æ–≤–æ–π —Ç–∞–±–ª–∏—Ü–µ–π:

### –®–∞–≥ 1: –î–æ–±–∞–≤—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Koyeb

–ó–∞–π–¥–∏ –≤ **Koyeb Dashboard** ‚Üí —Ç–≤–æ–π —Å–µ—Ä–≤–∏—Å ‚Üí **Environment Variables**

–î–æ–±–∞–≤—å:
```bash
USE_TEST_TABLE=true
TEST_SPREADSHEET_ID=1trmbJ7MwizcUZc2So3_5nktx0NnciGaSv1foVpfwd54
TEST_SPREADSHEET_NAME=[TEST] Bull Project
MOCK_MODE=false
```

### –®–∞–≥ 2: –ü–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏ —Å–µ—Ä–≤–∏—Å

Koyeb –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –ø–µ—Ä–µ–∑–∞–ø—É—Å—Ç–∏—Ç –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —Å –Ω–æ–≤—ã–º–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏.

### –®–∞–≥ 3: –ü—Ä–æ–≤–µ—Ä—å

API –Ω–∞ Koyeb —Ç–µ–ø–µ—Ä—å –±—É–¥–µ—Ç –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å **—Ç–æ–ª—å–∫–æ TEST —Ç–∞–±–ª–∏—Ü—É**.

‚ö†Ô∏è **–í–ê–ñ–ù–û**: –ù–µ –∑–∞–±—É–¥—å **–£–î–ê–õ–ò–¢–¨** —ç—Ç–∏ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –∫–æ–≥–¥–∞ –≤–µ—Ä–Ω–µ—à—å—Å—è –Ω–∞ production!

---

## üéØ –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–Ø

**–î–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è:**
1. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π **–ª–æ–∫–∞–ª—å–Ω—ã–π API** (`./run_api_test.sh`)
2. ‚úÖ –ë–æ—Ç —Ç–æ–∂–µ –ª–æ–∫–∞–ª—å–Ω—ã–π (`./run_test.sh`)
3. ‚úÖ –¢–µ—Å—Ç–∏—Ä—É–π –≤—Å–µ —Ñ—É–Ω–∫—Ü–∏–∏ –±–µ–∑ —Ä–∏—Å–∫–∞ –¥–ª—è production

**–î–ª—è production:**
1. ‚ùå **–ù–ï –¥–æ–±–∞–≤–ª—è–π** `USE_TEST_TABLE=true` –≤ Koyeb
2. ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–π production —Ç–∞–±–ª–∏—Ü—ã
3. ‚úÖ –î–µ–ø–ª–æ–π —Ç–æ–ª—å–∫–æ –ø–æ—Å–ª–µ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è

---

## üìã –ö–ê–ö –ü–†–û–í–ï–†–ò–¢–¨ –ß–¢–û API –í –¢–ï–°–¢–û–í–û–ú –†–ï–ñ–ò–ú–ï

### –ß–µ—Ä–µ–∑ API –∑–∞–ø—Ä–æ—Å:

```bash
curl http://localhost:8000/api/care/tables
```

**–¢–µ—Å—Ç–æ–≤—ã–π —Ä–µ–∂–∏–º (–ø—Ä–∞–≤–∏–ª—å–Ω–æ):**
```json
{
  "ok": true,
  "tables": {
    "[TEST] Bull Project": "1trmbJ7MwizcUZc2So3_5nktx0NnciGaSv1foVpfwd54"
  }
}
```

**Production —Ä–µ–∂–∏–º (–Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ –¥–ª—è —Ç–µ—Å—Ç–æ–≤):**
```json
{
  "ok": true,
  "tables": {
    "OCTOBER 2025": "...",
    "NOVEMBER 2025": "...",
    "DECEMBER 2025": "..."
  }
}
```

---

## üêõ TROUBLESHOOTING

### API –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç production —Ç–∞–±–ª–∏—Ü—ã –ø—Ä–∏ –ª–æ–∫–∞–ª—å–Ω–æ–º –∑–∞–ø—É—Å–∫–µ

**–ü—Ä–æ–±–ª–µ–º–∞:** –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –Ω–µ –∑–∞–≥—Ä—É–∑–∏–ª–∏—Å—å

**–†–µ—à–µ–Ω–∏–µ:**
```bash
# –ü—Ä–æ–≤–µ—Ä—å —á—Ç–æ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã:
cd /Users/muslimakosmagambetova/Downloads/tired2\ 2/bull_project
cat .env.local | grep USE_TEST_TABLE

# –î–æ–ª–∂–Ω–æ –±—ã—Ç—å:
USE_TEST_TABLE=true
```

### WebApp –Ω–µ –º–æ–∂–µ—Ç –ø–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è –∫ localhost API

**–ü—Ä–æ–±–ª–µ–º–∞:** CORS –∏–ª–∏ WebApp –∏–¥–µ—Ç –Ω–∞ Koyeb

**–†–µ—à–µ–Ω–∏–µ:** –£–±–µ–¥–∏—Å—å —á—Ç–æ –≤ browser console —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω:
```javascript
window.BULL_API_URL = "http://localhost:8000"
```

### Koyeb –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç —Ç–µ—Å—Ç–æ–≤—É—é —Ç–∞–±–ª–∏—Ü—É –Ω–∞ production

**–ü—Ä–æ–±–ª–µ–º–∞:** –ó–∞–±—ã–ª–∏ —É–¥–∞–ª–∏—Ç—å `USE_TEST_TABLE=true`

**–†–µ—à–µ–Ω–∏–µ:** –ó–∞–π–¥–∏ –≤ Koyeb ‚Üí Environment Variables ‚Üí —É–¥–∞–ª–∏ —Ç–µ—Å—Ç–æ–≤—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ

---

## üìö –°–¢–†–£–ö–¢–£–†–ê –§–ê–ô–õ–û–í

```
bull_project/
‚îú‚îÄ‚îÄ run_test.sh          # –ó–∞–ø—É—Å–∫ –¢–ï–°–¢–û–í–û–ì–û –±–æ—Ç–∞
‚îú‚îÄ‚îÄ run_api_test.sh      # –ó–∞–ø—É—Å–∫ –¢–ï–°–¢–û–í–û–ì–û API —Å–µ—Ä–≤–µ—Ä–∞ (–ù–û–í–´–ô!)
‚îú‚îÄ‚îÄ .env.local           # –¢–µ—Å—Ç–æ–≤–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è
‚îú‚îÄ‚îÄ .env.test            # –®–∞–±–ª–æ–Ω —Ç–µ—Å—Ç–æ–≤–æ–π –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏
‚îî‚îÄ‚îÄ bull_bot/
    ‚îú‚îÄ‚îÄ core/
    ‚îÇ   ‚îú‚îÄ‚îÄ api_server.py              # FastAPI —Å–µ—Ä–≤–µ—Ä
    ‚îÇ   ‚îî‚îÄ‚îÄ google_sheets/
    ‚îÇ       ‚îî‚îÄ‚îÄ client.py              # –ü–æ–¥–¥–µ—Ä–∂–∫–∞ USE_TEST_TABLE ‚úÖ
    ‚îî‚îÄ‚îÄ config/
        ‚îî‚îÄ‚îÄ constants.py               # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ TEST —Ä–µ–∂–∏–º–∞ ‚úÖ
```

---

**–ò—Å–ø–æ–ª—å–∑—É–π –ª–æ–∫–∞–ª—å–Ω—ã–π API –¥–ª—è —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è! üöÄ**
