# Функция текстового ввода имени вместо паспорта

## Описание

Теперь менеджеры могут вводить имя и фамилию паломника **текстом** вместо загрузки паспорта.

## Как использовать

### 1. Начать создание бронирования
- Нажать "Создать бронирование"
- Ввести количество паломников

### 2. Выбрать способ ввода данных

**Вариант А: Загрузить паспорт (как раньше)**
- Отправить фото или PDF паспорта
- Бот автоматически распознает все данные через OCR

**Вариант Б: Написать имя текстом (НОВАЯ ФУНКЦИЯ)**
- Написать текстом: `ФАМИЛИЯ ИМЯ`
- Например: `IVANOV IVAN`
- Бот примет данные и попросит следующий паспорт

### 3. Заполнить форму
- После всех паломников откроется форма
- Для паломников без паспорта нужно будет вручную заполнить:
  - Дата рождения
  - Номер паспорта
  - Пол
  - ИИН (если нужен)

## Примеры

### Пример 1: Один паломник без паспорта
```
Бот: "Отправьте паспорт 1-го паломника"
Менеджер: IVANOV IVAN
Бот: "✅ Принято: IVANOV IVAN
      ⚠️ Остальные данные нужно будет заполнить в форме"
```

### Пример 2: Группа - один с паспортом, один без
```
Бот: "Сколько паломников?"
Менеджер: 2

Бот: "Отправьте паспорт 1-го паломника"
Менеджер: [отправляет фото паспорта]
Бот: "✅ Распознано: PETROV PETR... Паспорт 2-го паломника:"

Менеджер: SIDOROV SERGEY
Бот: "✅ Принято: SIDOROV SERGEY"
     [Открывает форму]
```

### Пример 3: Имя с отчеством
```
Менеджер: KUANBAEVA RAYA ALTYBAEVNA
Бот: "✅ Принято: KUANBAEVA RAYA ALTYBAEVNA"
```

## Формат ввода

### Правильно ✅
- `IVANOV IVAN`
- `PETROV PETR IVANOVICH`
- `ivanov ivan` (автоматически переведется в IVANOV IVAN)
- `  SMITH  JOHN  ` (лишние пробелы удалятся)

### Неправильно ❌
- `IVANOV` (только фамилия, нет имени)
- `I` (слишком короткое)

### Если ввод неправильный
Бот покажет:
```
❌ Введите Фамилию и Имя через пробел

Например: IVANOV IVAN

Или отправьте фото/скан паспорта
```

## Технические детали

### Что сохраняется в базе данных

Для паломников, введенных текстом:
- `Last Name`: Введенная фамилия (в верхнем регистре)
- `First Name`: Введенное имя (в верхнем регистре)
- `Gender`: `M` (по умолчанию, можно изменить в форме)
- `Date of Birth`: `-` (заполнить в форме)
- `Document Number`: `-` (заполнить в форме)
- `IIN`: `-` (заполнить в форме)
- `passport_image_path`: `None` (паспорт не загружен)

### Когда использовать эту функцию

1. **Паспорт временно недоступен** - клиент пока не прислал скан
2. **Быстрое бронирование** - нужно срочно забронировать место
3. **Проблемы с OCR** - паспорт плохого качества и OCR не работает
4. **ID карты** - вместо паспорта только удостоверение личности

### Ограничения

⚠️ Менеджер должен будет вручную заполнить в форме:
- Дату рождения
- Номер паспорта
- Пол
- ИИН (если требуется)
- Срок действия паспорта

## Преимущества

✅ Быстрее - не нужно ждать OCR (30 секунд)
✅ Надежнее - нет ошибок распознавания
✅ Гибче - можно создать бронь до получения паспорта
✅ Проще - при плохом качестве скана

## Код

Файл: `bull_project/bull_bot/handlers/booking_handlers.py`
Функция: `process_passport_text()` (строка 299)

```python
@router.message(BookingFlow.waiting_passport, F.text)
async def process_passport_text(message: Message, state: FSMContext):
    """Обработка текстового ввода имени вместо паспорта"""
    # Парсим фамилию и имя
    parts = message.text.strip().split()
    if len(parts) < 2:
        await message.answer("❌ Введите Фамилию и Имя через пробел...")
        return

    last_name = parts[0].upper()
    first_name = " ".join(parts[1:]).upper()

    # Создаем минимальный набор данных
    p_data = {...}

    await next_step_pilgrim(message, state, p_data)
```

## Тестирование

Запустите тест:
```bash
python3 test_text_input.py
```

Результат должен показать успешную обработку всех тестовых случаев.

## Развитие функции (будущее)

В следующих версиях можно добавить:
1. Кнопка "Загрузить паспорт позже" для уже созданных броней
2. Автоматическое определение пола по имени (API)
3. Валидация формата даты рождения прямо в чате
4. Поддержка формата "Фамилия, Имя" (с запятой)
